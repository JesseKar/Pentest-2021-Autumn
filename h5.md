# Me In The Middle

## a) Totally Legit Sertificate. Asenna OWASP ZAP ja sen CA-sertifikaatti selaimeesi. Jos sinulla on jo ZAP, generoi uusi sertifikaatti ja asenna se.
- OWASP ZAPin voi ladata esim. [täältä](https://www.zaproxy.org/download/) ja CA-sertifikaatin löytää/generoi uuden ZAPista `Tools` -> `Options` -> `Dynamic SSL Certificate`.
- Tallenna sertti ja lisää se käytettäväksi `firefox` -> oikealta ylhäältä `preferences` -> hakuun cert ja `view certificates` ja `import` ja lisää tallentamasi sertti, ruksi vielä kohtaan `Trus this CA to identify websites`.

## b) Kettumainen kettu. Asenna FoxyProxy lisäke Firefoxiin. Tee siihen sääntö, joka ohjaa vain kohdepalvelimen liikenteen ZAP-proxyyn. Muu liikenne saa mennä suoraan proxyn ohi nettiin.
- FoxyProxyn löytää selaimen Add-oneista.
- Optionsseista lisää proxyn `add`

![foxy option](/h5-images/foxy_options.png)

- `Patterns` avaa säännöt 

![foxy patterns](/h5-images/foxy_patterns.png)

- Laitoin tähän kohdekoneen ([Secret](https://app.hackthebox.com/machines/Secret)) HackTheBoxista, ja kun selailen sivun liikennettä, FoxyProxy firefoxin oikealla yläkulmassa näyttää ![foxy match](/h5-images/foxy_match.png) ja kun en ole patternin alueella se näyttää ![foxy no match](/h5-images/foxy_nomatch.png)

## c) Kokeile, että ZAP sieppaa liikenteen valitsemastasi harjoitusmaalista. Kohteena HTBn Secret kuten yllä.
- Zap sieppaa liikenteen sivun hakukentältä

![zap break](h5-images/zap_break.png)

## d) Edit & resend. Näytä ZAP:lla esimerkki pyynnön uudelleen lähettämisestä (edit and resend).
- Avataan lähetetystä pyynnöstä `Open/Resend with Request Editor`

![zap Request editor](/h5-images/zap_req_editor.png)

- Muokataan pyyntöä ja klikataan `Send`
- Edellinen ja muokattu pyyntö näkyvät näppärästi historiassa

![zap sieppaako](/h5-images/zap_sieppaako.png)
![zap muokattu](/h5-images/zap_muokattu.png)

## c) Break. Pysäytä ZAP:lla pyyntö tiettyyn URLiin, muokkaa sitä ja päästä eteenpäin.
- Maalikone ehkä vähän huono esimerkki tässä, mutta seuraavia muokkauksia tein hakukenttäpyynnölle. Ohjasin sen toiselle sivulle ja muokkasin userAgenttia. Haun sijaan avautui siis docsit

![zap stop edit](/h5-images/zap_stop_edit.png)
![zap edited url](/h5-images/zap_edited_url.png)

## d) Automaagista. Tiedustele valitsemasi harjoitusmaali ZAP:n automaattisilla toiminnoilla, kuten spider ja forced browsing. Arvioi ZAP:n tuloksia, kuten löytyneitä tiedostoja ja varoituksia.
- Painelin spiderin menemään koko sivulle ip-osoitteesta `right click` -> `attack` -> `spider` ja tää ei ehkä ollut paras veto, spideri alkoi läpikäydä jokaista assettia, bootstrapit yms läpi ja kamaa tuli todella paljon, yli 40000 tulosta.
- Spider läpikäy kaikki polut, kirjoittaa inputteihinkin ZAP saadakseen tuloksia
- Löytyi yksi ladattava zip tiedostokin
- Skippaa scoping ulkopuolella olevat urlit
- Forced browse scannissa hakemistolista on ilmeisen pitkä ja näyttää hitaalta koko homman läpikäymiseksi. Tuloksia alkaa tulla kuitenkin heti.

![zap forced browse](/h5-images/zap_dir_scan.png)

## Sekä Zappia, että ilmaisversiota Burpsuitesta kokeilleena, koen että Burppi on helpompi/suoraviivaisempi käyttää etenkin pyyntöjen keskeyttäiseen, muokkaamiseen ja lähettämiseen. Kohdekone oli tässä kokeillessa ehkä hieman huono, joten täytyy Zappia kokeilla toistekin toiseen kohteeseen paremmalla ajalla. Zapissa hudi on ihan näppärä, mutta tuntuu bugaavan/ei toimi aika usein. 

## e) Starting point. HackTheBox. Liitä vastaukseesi ruutukaappaus, jossa Starting pointin ilmaiset osat näkyvät ratkaistuna profiilissasi.
- Meow
    - Root flägin saa kun kirjautuu maaliin telnetillä ja antaa salasanan root, kuten aiemmissa stepeissä vihjattiin. Flägi on tiedostossa flag.txt
- Fawn
    - Koneessa ftp, nmap -sV -sC paljastaa, että koneessa auki anonymous logini, ja flägi löytyykin flag.txtstä
- Dancing
    - smbclientillä yhteys smb. Directoryt löytyy -L, yhdistetään WorkShares, löytyy 2 kansiota, toisesta flagi, ja getillä ladataan.

![starting point](/h5-images/starting_point.png)

- Appointment
    - Http portti, webbisivun takana login sivu, gobusterilla ei mielenkiintoisia sivuja, tutkitaan formin pyyntöjä.
    - Post pyyntö, selkokielinen payloadi, kokeillaan SQL injektiota usernameen `admin'#` ja saadaan pyyntö läpi siten, että se skippaa salasanan, koska formia ei ole validoitu. Aukeaa flägisivu.
- Sequel
    - Koneessa SQL, roottina pääsikin sisään ilman kirjautumisia :d `mysql -h <ip> -u root`
    - MySQL liikkumista, plärätään tietokantoja läpi, htb databasesta config taulusta löytyykin flägi
- Crocodile
    - ftp ja http palvelut, fpt pääsee taas anonymous sisään, pari kiinnostavaa filua, tiedot talteen mitä saa. Gobusterilla nettisivuista hakemistot ja php päätteiset sivut alkajaisiksi. Kirjautumissivu kiinnostaa. Tiedostoista löydetyt käyttäjä-salasanaparit testiin, aloitetaan administa ja kirjautuminen onnistuu ja flägi löytyy.

![starting point2](/h5-images/starting_point2.png)

- Archetype
    - nmapin jälkeen smbclientillä leikkimään `sudo smbclient -N -L <ip>`, getillä filu itselle ja sisältä salasana ja user id.
    - Yritettiin ladata impacket ja mssqlclient.py, jolla voi yhdistää microsoftin sql serverille ja ohjeiden mukaan toimittu, ei vaan wörki
- Oopsie
    - todo
- Vaccine
    - todo


## f) Appointment. Kuinka monta lähestymistapaa keksit? Jos jokin ei toimi, kokeile jotain muuta. Kuinka pitkälle pääsit?
- Löytyy e) kohdan alta

## h) Vapaaehtoinen. Kokeile jotain helppoa konetta HTB Starting Pointista.
- Näistä nopeita läpikäyntejä aiemmin pääpointteineen e) kohdassa

## i) Vapaaehtoinen, vaikeahko: Kokeile jotain helppoa konetta HTB Machines-verkosta.
- Kone Secret, tiedot toisaalla


## Lähteet
- [Kurssisivu, Tero Karvinen](https://terokarvinen.com/2021/penetration-testing-course-2021-autumn/#h5-me-in-the-middle)
- [OWASP ZAP](https://www.zaproxy.org/)
- [FoxyProxy](https://getfoxyproxy.org/)
- [HackTheBox](https://app.hackthebox.com/home)
- [Hydra](https://www.kali.org/tools/hydra/)
- [OWASP Juice Shop](https://owasp.org/www-project-juice-shop/)
- [Zap proxy](https://www.zaproxy.org/download/)