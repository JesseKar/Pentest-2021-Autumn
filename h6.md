# h6 hunter2

## z) Lue artikkelit ja katso videot, tee kustakin muistiinpanot (muutama ranskalainen viiva per artikkeli/video). Tässä z-kohdassa ei tarvitse tehdä mitään kokeita koneella.

### [Taylor et al 2018: The Art of Hacking: Hacking User Credentials](https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_06_00/) € (8 videota, yhteensä noin 40 min)
- Kirjautumistunnukset yleensä tallennetaan tietokantoihin
    - Sekä tietokanta, että tietojen siirtymisvaihe on suojattava
- MITM hyökkäykset, brute force, sniffing, phishing

- Brute forcessa lähtökohta löytää ensin validit käyttäjänimet ja sitten forceta salasanoja niihin
    - Metasploit `auxiliary/scanner/smb/smb_enumusers` ja monia muita käyttäjien enumerointi scannereita eli palveluihin kuten vaikka SSH
    - Nmapissa omia scriptejä tähän myös
        - yksi `SNMP` enumuser script
    - SMD / NetBIOS / Samba -> RPC interface hyökkäys tai brutetaan LSA

- GPUlla salasanojen hashien yrittäminen todella nopeaa

- Hashcat, John The Ripper, wfuzz, hydra etc.

### Yksi vapaavalintainen ratkaisu vanhoista (retired) HTB:n koneista. Löytyy esimerkiksi näistä:
#### [HTB: Delivery](https://0xdf.gitlab.io/2021/05/22/htb-delivery.html) (retired), nopea läpikävely
- Nmapista näkee portit 22 SSH, 80 HTTP ja 8065 HTTP auki
- Löytyi subdomain, joten se ja ja base domain -> /etc/hosts filuun
- Sivulta selviää 8065 portin syy, eli MatterMost server
- Käyttäjän luominen sähköpostilla umpikuja ja kirjautuminen myös
- Ticketin statuksen formia ei ole validoitu, joten siitä lähteviä pyyntöjä voidaan kivasti muokkailla
- MatterMostissa kirjautumissivu ja rekisteröimis sivuilla formit, rekkaus johtaa sähköpostivarmistamiseen joka on HTB koneissa usein umpikuja
- Käyttäjä vihjatulla @delivery.htb emaililla ja ticket sivulle saatiin sähköpostiin ja saatiin käyttäjä luotua ja päästiin kirjautumaan
- Tiimiin liittymisen jälkeen näkyy chatti jossa root viestejä ja käyttäjänimi ja salasana yhteen käyttäjään
    - Lisäksi tieto, että useat salasanat on variantteja PleaseSubscribe! salasanasta ja hashcat rulesista
- Viestin tunnareilla pääsee SSHlla hakemaan user flägin
- MatterMostin konffitiedostossa tietokantayhteyden informaatio
    - Salasana myös siellä
- Yhteys SQLään, löytyy users table, jossa paljon salasanoja ja käyttäjiä, myös root
- Hashcatilla best64 rulella PleaseSubscribe! root hash auki ja rootin salasana selville
- Sshssä vaihto roottiin salasanalla ja flägi tallessa

## a) Tee 3 tiivistettä eri ohjelmilla ja arvaa ne hashcatilla. Tiivistä jokin oma sana, ei sanaa 'hashcat'. Voit käyttää tässä demossa itse tehtyä sanakirjaa, jossa on oikea ratkaisu muutaman väärän joukossa. Kuvaile myös, miten teit tiivisteet.
- Tehdään 3 md5 salasanaa eri työkaluilla
- Eka salasana tehty `echo -n 'mypassword' | md5sum`
- Toka salasana tehty [CyberCheffissä](https://gchq.github.io/CyberChef/#recipe=MD5()&input=c2FsYXNhbmExMjM) 

![cyber](/h6-images/a-cc.png)

- Kolmas pythonilla `python -c "from hashlib import md5; h = md5(); h.update('pyyttoni'); hash = h.hexdigest(); print(hash)"`
- Oma sanalista tehty mahdollisista salasanoista sekä oma lista hasheille, ajetaan hashcatilla
- `hashcat -m 0 -a 0 hashes.txt pass_list.txt`
- Ja saadaan tulokset näkyviin

![results](/h6-images/a-results.png)

## b) Kokeile Hydraa ssh:ta vastaan.
- Ajoin hydraa metasploitable 2 vastaan itse luoduilla listoilla
![hydra example](/h6-images/hydra_example.png)

<!-- SHIT STORM -->
## c) Kokeile salasanoja omaan weppilomakkeeseen.
- Python Flaskia ihmettelin tovin, mutta kiireen iskiessä päälle totesin, että käyn kokeilemassa brute forcea metasploitable 2 DVWAssa webbilomakkeeseen, kun sieltä löytyy tällainen mahdollisuus. 
- Tsekkasin network välilehdeltä payloadin ja cookiet ja iskin ne hydraan ja löin sisään seuraavanlaisen komennon
    - `hydra 192.168.0.20 -V -l admin -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt http-get-form "/dvwa/vulnerabilities/brute/:username=^USER^&password=^PASS^&Login=Login:F=Username and/or password incorrect.:H=Cookie: 1399c8b0e3f51250a8ddd0b951f9f529; security=low"`
    - Tää jäi jostain syystä jumiin 16 ekan yrityksen jälkeen ja aika ihmettelyyn loppui tältä erää kesken

<!-- SHIT STORM -->

## d) Tee oma sanalista itse tekemästäsi ja keksimästäsi weppisivusta.
- Tein omia sanalistoja cewlillä ja katsoin tutoriaalin [täältä](https://www.exploitone.com/tutorials/create-your-own-wordlist-to-brute-force-a-website-using-cewl/)
- Loin oman weppisivun apachella johon loin [random text generaattorilla](https://randomtextgenerator.com/) tekstiä
- `cewl http://127.0.0.1/ -w wordlist.txt` luo sivusta sanalistan ja tallettaa sen tiedostoon
- `cewl http://127.0.0.1/ -m 10 -w wordlist10.txt` luo sivusta sanalistan, jossa jokaisessa sanassa on minimissään 10 kirjainta ja tallettaa sen tiedostoon

## e) Murra zip-paketin salajanasuojaus.
- Aluksi loin salatun zipatun lists.zip tiedoston, jossa muutama tiedosto

![zip](/h6-images/zip.png)

- Sitten haetaan salasanojen hashit zip2johnilla ja tallennetaan tiedosotoon `zip2john lists.zip > hashes.txt`
- Sitten johnilla sanalistalla yritetään murtaa `john --wordlist=pass_list.txt hashes.txt`
- Salasana murrettu ja näkyy alla

![zip2john](h6-images/zip2john.png)

## f) Murra jonkin muun tiedoston salasanasuojaus.
- GPG
    - [Täältä](https://blog.atucom.net/2015/08/cracking-gpg-key-passwords-using-john.html) löysin ohjeet gpg avaimen tekoon ja sen murtamiseen.
    - Ensin generoin avaimen `gpg --full-generate-key` ja täyttelin kohtia sitä mukaan kun ohjelma kyseli vaihtoehtoja ja annoin avaimelle nimen `kalii`
    - Sitten exporttasin avaimen, jotta sitä voi käyttää `gpg --export-secret-key --armor kalii > kalii.priv`
    - Ja sitten gpg2johnilla hain avaimen hashin ja tallensin sen tiedostoon `gpg2john kalii.priv > gpg_hash_test.txt`
    - Ja ajoin johnia tallennettuun hashtiedostoon sanalistalla `john --wordlist=pass_list.txt gpg_hash_test.txt`

    ![gpg2john](/h6-images/gpg2john.png)

### g) Salasanan taakse / ei julkiseen nettiin: Tiedustele perusteellisesti jokin HTB Machines verkon kone. Selitä tulokset. Luettele lähestymistavat, joilla murtautumista voisi aloittaa. (Tämä pitää laittaa piiloon, koska HTB:lla on näistä kilpailu, emmekä halua spoilata sitä)
- Tiedot toisaalla

##### m) Vapaaehtoinen kilpailu: kuka saa eniten Machines-verkon aktiivisia koneita korkattua? Laita Terolle viesti, jos saat yhdenkin auki. Kerron palkinnon tunnilla.


# Lähteet: 
- [Kurssisivu, Tero Karvinen](https://terokarvinen.com/2021/penetration-testing-course-2021-autumn/#h6-hunter2)
- [Taylor et al 2018: The Art of Hacking: Hacking User Credentials](https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_06_00/)
- [HTB: Delivery](https://0xdf.gitlab.io/2021/05/22/htb-delivery.html)
- 