z) OWASP 10 A03:2021 - Injection
    Sovellus on altis hyökkäyksille, kun käyttäjän syötteitä ei käsitellä oikein tai kun ohjelman muoto on helposti muokattavissa, esim SQL-injektiot.

    Yleisimpiä injektioita ovat SQL, NoSQL, OS command, ORM, LDAP, EL, OGNL.
    Lähdekoodin tarkastelulla nähdään, onko sovellus altis injektioille.

    Miten estää injektiot?
    Käytetään turvallista APIa, ilman tulkkia parametroidulla käyttöliittymällä.
    Tarkastetaan käyttäjäsyötteet.
    Käytetään LIMIT tai muita SQL rajoittimia massakyselyiden luomiseksi.


Hutchins

    Jotkut toimijat voivat käyttää pitkiä aikoja, jopa monivuotisia tunkeutumiskampanjoita arkaluontoisten tietojen hankkimiseen mm. valtiolta tai muilta suurilta toimijoilta. Käytössä usein laaja ja monipuolinen arsenaali erilaisia tunkeutumistyökaluja.

Intrusion Kill Chain

    Systemaattinen prosessi, jolla aikaansaadaan halutut vaikutukset.
    Tiedustelu, kohteiden tunnistaminen ja valinta
    Aseistus, esim troijalaisen yhdistäminen asiakassovellukseen kuten pdf
    Toimitus, aseen siirto kohdeympäristöön, esim sähköpostiliitteenä
    Hyödyntäminen, mitä ase tekee kohteessa, esim. kohdistuuko sovellukseen vai käynnistääkö jotain
    Asennus, mahdollistaa tunkeutujan säilyttää yhteys kohteeseen
    Komento ja ohjaus, tunkeutujalla mahdollisuus käyttää kohdetta omilla syötteillä
    Tavoitteita koskevat toimet, alkuperäisten tavoitteiden toteutus mm. tietojen keruu


Courses of Action

    Havaitse, kiellä, häiritse, hajota, petä ja tuhoa.
    Jatkuvan seurannan avulla tunkeutumisen tunnistaminen ja sen estäminen.
    Uusien hyökkäysten tunnistaminen kill chainin eri vaiheissa.

a) Over The Wire: Tasot 0-5

    Level 0: cat readme
    Level 1: cat ./-
    Level 2: cat spaces\ in\ this\ filename
    Level 3: cat .hidden
    Level 4: file ./-file*
    cat ./-file07
    Level 5: find -type f -size 1033c

b) Kali Linux asennettu VirtualBoxiin.

c) WebGoat asennettu Kali Linuxiin, käyttäjä luotu ja kirjatuminen onnistunut.

d) Ratkaise WebGoatista tehtävät HTTP Basics, Developer Tools ja A1 Injection (intro)

HTTP Basics

    Tehtävässä kuuluu syöttää nimi input-kenttään ja lähettää se. Selaimen (firefox) Network välilehdeltä näkee lähetetyn datan, eli kyseessä on POST pyyntö ja tiedosto attack1. Sivun lähdekoodia tutkimalla Inspector välilehdeltä ja haulla magic, löytyy kysytty magic number 41.

Developer Tools

    Kehittäjätyökalut. Ctrl + shift + I avaa firefoxin kehittäjätyökalut. Inspector välilehdeltä voi tarkastella sivun HTML ja CSS koodia, Consolessa ajaa omaa javascript koodia. CTRL + SHIRT + L tyhjentää konsolin. 
    Ensimmäisessä tehtävässä konsolissa kuuluu ajaa webgoat.customjs.phoneHome() funktio joka palauttaa vaaditun numeroarvon. Debugger välilehdeltä löytyy kaikki webbisivun luomiseen tarvitut tiedostot. Network välilehti näyttää sivun suorittamat requestit ja responset ja niitä voi tutkia tarkemmin yhtä tapahtumaa klikkaamalla. 
    Viimeisessä tehtävässä pitääkin etsiä Networkistä tietty HTTP requesti joka sisältää kentän networkNum. Numero toimii vastauksena kysymykseen. Vastaus löytyy POST pyynnöstä, jonka tiedostona on network ja sen request välilehdeltä.

A1 Injection - SQL Injection (intro)

    Aiheessa käsitellään mitä SQL on ja miten sitä voi manipuloida tekemään asioita, joita ei alunperin ollut tarkoitus tehdä. SQL on relaatiotietokantoja käsittelevä ohjelmointikieli.
    Ensimmäisessä tehtävässä haetaan Bob Francon osasto 
        SELECT department FROM employees where first_name='Bob' AND last_name='Franco
    DML on datan manipulointikieli, jolla voidaan hakea, lisätä, poistaa ja muokata dataa tietokannassa.
    Toisessa tehtävässä muutetaan Tobin departmenttiä
        UPDATE employees SET department='Sales' where first_name='Tobi' AND last_name='Barnett' 
    DDL on datan määrittelykieli, jolla voidaan määritellä tietokannan tietorakenteet.
    Kolmannessa tehtävässä lisätään phone kenttä employees tableen.
        ALTER table employees ADD phone varchar(20)
    DCL on datan kontrollointikieli, jolla määritellään käyttöoikeudet tietokannan käyttäjille. Neljännessä tehtävässä annetaan Unauthorized userille käyttöoikeudet tablejen muokkaamiseen.
        GRANT ALTER TABLE TO UnauthorizedUser

    SQL-injektiot ovat todella yleistä. SQL-injektio tarkoittaa haitallisen koodin lisäämistä käyttäjän SQL hakuun. SQL-injektioilla voidaan aiheuttaa paljon tuhoa kuten tietojen vuotamista, tuhoutumista tai käytön keskeytymistä.
    Sivun 9 vastaus toimii, koska '1'='1' palauttaa truen kyseiselle kentälle.
        SELECT * FROM user_data WHERE first_name = 'John' and last_name = '' or '1' = '1'
    Sivun 10 tehtävässä User_Idlle voidaan antaa taas injektio joka palauttaa truen
        SELECT * From user_data WHERE Login_Count = 1 and userid= 1 or 1=1
    String SQL injektioissa hyödynnetään ketjutettuja merkkijonoja. Sivun 11 tehtävässä injektoidaan auth_tanille arvo joka palauttaa truen
        TAN input kenttään: ' OR '1'='1
    Query chainingissä lisätään kyselyn perään uusia kyselyitä, siis ketjutetaan ; merkillä. Sivun 12 tehtävä:
        '; UPDATE employees SET salary = 100000 where auth_tan = '3SL99A
    SQL-injektioiden jälkeen on hyvä poistaa lokit. Sivun 13 vastaus:
        '; DROP TABLE access_log --


e) OverTheWire: Bandit, levels 6-10.

    Level 6: find / -type f -group bandit6 -user bandit7 -size 33c 2>/dev/null
    Level 7: sort data.txt | grep millionth
    Level 8: sort data.txt | uniq -c | grep '^ *1 '
    Level 9: strings data.txt | grep '=='
    Level 10: strings data.txt | base64 --decode


f) Vapaaehtoinen: Hanki TryHackMe-tunnus, lue säännöt, tee jokin harjoitus.
//TODO
h) Vapaaehtoinen: Hanki HackTheBox-tunnus, lue säännöt, kokeile helppoa konetta.
//TODO

Lähteet:
https://overthewire.org/wargames/bandit/
https://owasp.org/www-project-webgoat/
https://github.com/WebGoat/WebGoat/
https://owasp.org/Top10/A03_2021-Injection/
https://lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf


