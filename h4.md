# Tiedustelua

# z) [Santos et al: [The Art of Hacking]](https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_03/)
- Skannaus on hyvä aloittaa pienemmistä ja hiljaisemmista skannauksista, ensin kohteita etsien ja minimaalisilla jäljilla, esim listaskannauksella -sL
- Potentiaalisien kohteiden löytyessä skannauksen äänekkyyttä voidaan siirtyä kyseisten kohteiden porttiskannauksiin

### 4.3 Surveying Essential Tools for Active Recoinnaissance
- NMAP aikalailla paras porttiskanneri, joka tunnistaa mm. myös järstelmiä, palveluita, ja tekee haavoittuvuuskannauksia
- -sS nopea skannaus, lähettää kyselyitä porteille muttei vastaa niihin.
- -T0-5 skannauksen nopeus
- -A sallii järjestelmien tunnistamisen ja version tunnistamisen
    - esim. `sudo nmap -sS -vv -T4 -A 192.168.56.102`
- -Pn käsittelee kaikkia portteja kuin ne olisivat online, joten skannaus ei skippaa vaikkapa tulimuurin blokatessa tietyt portit näkyvistä
- Defaulttina NMAP skannaa default portit, mutta -p voi määrittää mitkä portit, tai vaikka kaikki portit -p-
- 

- Muita skannereita:
    - Masscan (nopein porttiskanneri)
        - esim tietyt portit: `masscan -p80, 443 192.168.56.102/24 --rate=10000`

    - Udpprotoscanner (UDP services)

- EyeWitness
    - Voi tarkistaa useita nettisivuja keräten niistä tietoa, jonka perusteella on helpompi päättää mihin sivuihin kannattaa keskittyä. Esim löytää sadasta sivusta ne, joissa login sivuja, eikä tarvitse manuaalisesti tutkia sivustoja itse
    - `./EyeWitness.py --web -f ip_list.txt`
    - Annetaan EyeWitnessille lista osoitteista, ja se tutkii ne
    - Ottaa sivuista screenshotit ja muuta tietoa, tuloksia voi tutkia raporttisivulla

### 4.4 Network and Web Vulnerability Scanners
- Network vulnerability scanners
    - OpenVAS, NMAP
- Web vulnerabilty scanners
    - Nikto, WPScan, SQLMap, Burp Suite, Zed Attack Proxy

- NMAP vuln scan:
    - Nmap skritpit löytyy [nmapin nettisivuilta](https://nmap.org/nsedoc/)
    - Skriptit voi ladata sivulta ja sijoittaa `/usr/share/nmap/scripts` käytettäväksi
    - sC ajaa defaultin setin scriptejä ja jotkut scripteistä ovat sellaisia, ettei niitä pidä käyttää ilman lupaa

### [Nmap portti skannauksen perusteet](https://nmap.org/book/man-port-scanning-basics.html)
- Nmap jakaa portit kuuteen erilaiseen tilaan, joista tarkastellaan seuraavat
    - Open
        - Ykköskohteita porttiskannauksessa. Applikaatiot avoimissa porteissa ottavat aktiivisesti vastaan TCP yhteyksiä. Jokainen avoin portti on mahdollinen väylä hyökkäykselle. 
    - Closed
        - Suljettu portti on tavoitettavissa, mutta yksikään applikaatio ei kuuntele siellä. Nämä portit antavat viittauksia siitä, että kohde on päällä ja auttaa käyttöjärjstelmän tunnistamisessa. Jatkoa ajatellen niitä on hyvä tarkkailla, sillä käyttäjä saattaa avata ne.
    - Filtered
        - Nmap ei tunnista onko portti auki, koska esim. tulimuuri filtteroi pakettien lähetyksen. Huonompi juttu hyökkääjän näkökulmasta, koska tarjoavat vähän informaatiota ja nmapin lähettäessä uusia pyyntöjä varmistaakseen portin tilan, filtteröity portti hidastaa skannausta.

# Miten nmap toimii?
- Tehdään nmapilla seuraavat testit, siepataan liikenne snifferillä ([Wireshark](https://www.wireshark.org/)), ja analysoidaan tulokset. Skannataan vain omia koneita/harjoitusmaaleja, omassa verkossa.

## a) nmap TCP connect scan -sT

## b) nmap TCP SYN "used to be stealth" scan, -sS (tätä käytetään skannatessa useimmin)

## c) nmap ping sweep -sn

## d) nmap don't ping -Pn

## e) nmap version detection -sV (esimerkki yhdestä palvelusta yhdessä portissa riittää)

## f) nmap porttien valinta -p1-100, --top-ports 5, -p-

## g) nmap ip-osoitteiden valinta; luettelo, verkkomaskilla 10.10.10.0/24, alku- ja loppuosoitteella 10.10.10.100-130 (ipcalc auttaa ymmärtämään, miten verkkomaskia tulkitaan)

## h) nmap output files -oA foo. Mihin kukin tiedostotyyppi sopii?

## i) nmap version scanning -sV

## j) nmap OS fingerprinting, version detection, scripts, traceroute, -A

## k) nmap ajonaikaiset toiminnot (man nmap: runtime interaction): verbosity v/V, help ?, packet tracing p/P, status s (ja moni muu nappi)

## l) normaalisti 'sudo nmap'. Miten nmap toiminta eroaa, jos sitä ajaa ilman sudoa? Suorita ja analysoi esimerkki.

## m) nmap, vertaile -sV vs -A kestoa (ja lähetetyn datan määrää jos osaat; time, nethogs, wireshark). Käytä harjoitusmaalina metasploitable2.

## d) Ninjojen tapaan. Piiloutuuko nmap-skannaus hyvin palvelimelta? Vinkkejä: Asenna Apache. Aja nmap-versioskannaus -sV omaan paikalliseen weppipalvelimeen. Etsi Apachen lokista tätä koskevat rivit. Wiresharkissa "http" on kätevä filtteri, se tulee siihen yläreunan "Apply a display filter..." -kenttään. Nmap-ajon aikana p laittaa packet tracing päälle. Vapaaehtoinen lisäkohta: jääkö Apachen lokiin jokin todiste nmap-versioskannauksesta?

## UDP-skannaus. "Mulla olis vitsi UDP:sta, mutta en tiedä menisikö se perille":

## e) Mitkä ovat tavallisimmat tai kiinnostavimmat palvelut, joita UDP-skannauksella voisi löytää? (tässä alakohdassa vain vastaus viitteineen, ei tarvita testiä tietokoneella)

## f) Miksi UDP-skannaus on hankalaa ja epäluotettavaa? Miksi UDP-skannauksen kanssa kannattaa käyttää --reason flagia? (tässä alakohdassa vain vastaus viitteineen, ei tarvita testiä tietokoneella)

## g) Vapaaehtoinen bonuskohta: näytä esimerkki onnistuneesta UDP-skannauksesta, sekä jonkin UDP:n erityisominaisuuden takia epäonnistuneesta tai harhaanjohtavan tuloksen antavasta UDP-skannauksesta.

# Aktiivista tiedustelua. Mihin tämä työkalu on tarkoitettu? Kokeile tätä työkalua omaan harjoitusmaaliin ja selitä tulokset:

## h) fuff (hakemistojen kokeilu riittää, vapaaehtoisena bonuksena muutakin)

## i) nikto

# j) Pizza fantasia: jokin valitsemasi tiedustelutyökalu, esimerkiksi EyeWitness, wpscan, openvas tai jokin muu.






# k) Vapaaehtoinen: Tiedustele aktiivisesti jokin HackTheBoxin maalikone. Analysoi tulokset, pääpaino on vastauksessa tulkinnoillasi. Sopivia ovat esimerkiksi EyeWitness, nikto, wpscan, gobuster, openvas ja ffuf. Aputyökaluiksi sopii Linuxin komentokehote, grep, pythonpy... Voit valita näistä vain jonkin tai joitakin työkaluja. Seuraa työkalun toimintaa koko ajan snifferillä, ja käytä vain työkaluja, joiden toiminnan ymmärrät kohtuullisesti. HTB:n ratkaisut yhdessä sovitun salasanan taakse, jotta emme spoilaa toisten kilpailua.

# l) Vapaaehtoinen, haastava: Korkkaa jokin HTB:n kone. Aloita helposta.



- Lähteet
- [Kurssisivu, Tero Karvinen](https://terokarvinen.com/2021/penetration-testing-course-2021-autumn/#h4-tiedustelua)
- [Santos et al: [The Art of Hacking]](https://learning.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_03/)
- 